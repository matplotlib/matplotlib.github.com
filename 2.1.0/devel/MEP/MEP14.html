<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MEP14: Text handling &mdash; Matplotlib 2.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/mpl.css"
type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css"
type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Matplotlib 2.1.0 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html"
/>
    <link rel="search" title="Search" href="../../search.html"
/>
    <link rel="top" title="Matplotlib 2.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Matplotlib Enhancement Proposals" href="index.html" />
    <link rel="next" title="MEP15 - Fix axis autoscaling when limits are specified for one axis only" href="MEP15.html" />
    <link rel="prev" title="MEP13: Use properties for Artists" href="MEP13.html" /> 


  </head>
  <body>


<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; position: relative;">
<a href="../../index.html"><img src="../../_static/logo2.svg" width="540px" border="0" alt="matplotlib"/></a>

<!-- The "Fork me on github" ribbon -->
<div id="forkongithub"><a href="https://github.com/matplotlib/matplotlib">Fork me on GitHub</a></div>
</div>




    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="MEP15.html" title="MEP15 - Fix axis autoscaling when limits are specified for one axis only"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="MEP13.html" title="MEP13: Use properties for Artists"
             accesskey="P">previous</a> |</li>

        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../gallery/index.html">examples</a>|&nbsp;</li>
        <li><a href="../../tutorials/index.html">tutorials</a>|&nbsp;</li>
        <li><a href="../../api/pyplot_summary.html">pyplot</a>|&nbsp;</li>
        <li><a href="../../contents.html">docs</a> &raquo;</li>
          <li><a href="../index.html" >The Matplotlib Developers’ Guide</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Matplotlib Enhancement Proposals</a> &raquo;</li> 
      </ul>
    </div>

  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><a href="https://www.numfocus.org">
  <image src="https://img.shields.io/badge/powered%20by-NumFOCUS-orange.svg?style=flat&amp;colorA=E1523D&amp;colorB=007D8A">
</a>

<br/>

<a href="http://depsy.org/package/python/matplotlib">
  <img src="../../_static/depsy_badge.svg">
</a>

<br/>

Travis-CI: <a href="https://travis-ci.org/matplotlib/matplotlib">
  <img src="https://travis-ci.org/matplotlib/matplotlib.svg?branch=master"/>
</a>
<br/>
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MEP14: Text handling</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#branches-and-pull-requests">Branches and Pull requests</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#detailed-description">Detailed description</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#backward-compatibility">Backward compatibility</a></li>
<li><a class="reference internal" href="#alternatives">Alternatives</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../contents.html">Documentation overview</a><ul>
  <li><a href="../index.html">The Matplotlib Developers’ Guide</a><ul>
  <li><a href="index.html">Matplotlib Enhancement Proposals</a><ul>
      <li>Previous: <a href="MEP13.html" title="previous chapter">MEP13: Use properties for Artists</a></li>
      <li>Next: <a href="MEP15.html" title="next chapter">MEP15 - Fix axis autoscaling when limits are specified for one axis only</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/devel/MEP/MEP14.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mep14-text-handling">
<h1>MEP14: Text handling<a class="headerlink" href="#mep14-text-handling" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#status" id="id2">Status</a></li>
<li><a class="reference internal" href="#branches-and-pull-requests" id="id3">Branches and Pull requests</a></li>
<li><a class="reference internal" href="#abstract" id="id4">Abstract</a></li>
<li><a class="reference internal" href="#detailed-description" id="id5">Detailed description</a></li>
<li><a class="reference internal" href="#implementation" id="id6">Implementation</a></li>
<li><a class="reference internal" href="#backward-compatibility" id="id7">Backward compatibility</a></li>
<li><a class="reference internal" href="#alternatives" id="id8">Alternatives</a></li>
</ul>
</div>
<div class="section" id="status">
<h2><a class="toc-backref" href="#id2">Status</a><a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Discussion</strong></li>
</ul>
</div>
<div class="section" id="branches-and-pull-requests">
<h2><a class="toc-backref" href="#id3">Branches and Pull requests</a><a class="headerlink" href="#branches-and-pull-requests" title="Permalink to this headline">¶</a></h2>
<p>Issue #253 demonstrates a bug where using the bounding box rather than
the advance width of text results in misaligned text.  This is a minor
point in the grand scheme of things, but it should be addressed as
part of this MEP.</p>
</div>
<div class="section" id="abstract">
<h2><a class="toc-backref" href="#id4">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>By reorganizing how text is handled, this MEP aims to:</p>
<ul class="simple">
<li>improve support for Unicode and non-ltr languages</li>
<li>improve text layout (especially multi-line text)</li>
<li>allow support for more fonts, especially non-Apple-format TrueType
fonts and OpenType fonts.</li>
<li>make the font configuration easier and more transparent</li>
</ul>
</div>
<div class="section" id="detailed-description">
<h2><a class="toc-backref" href="#id5">Detailed description</a><a class="headerlink" href="#detailed-description" title="Permalink to this headline">¶</a></h2>
<p><strong>Text layout</strong></p>
<p>At present, matplotlib has two different ways to render text:
“built-in” (based on FreeType and our own Python code), and “usetex”
(based on calling out to a TeX installation).  Adjunct to the
“built-in” renderer there is also the Python-based “mathtext” system
for rendering mathematical equations using a subset of the TeX
language without having a TeX installation available.  Support for
these two engines in strewn about many source files, including every
backend, where one finds clauses like</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]:</span> <span class="c1"># do one thing else: # do another</span>
</pre></div>
</div>
<p>Adding a third text rendering approach (more on that later) would
require editing all of these places as well, and therefore doesn’t
scale.</p>
<p>Instead, this MEP proposes adding a concept of “text engines”, where
the user could select one of many different approaches for rendering
text.  The implementations of each of these would be localized to
their own set of modules, and not have little pieces around the whole
source tree.</p>
<p>Why add more text rendering engines?  The “built-in” text rendering
has a number of shortcomings.</p>
<ul class="simple">
<li>It only handles right-to-left languages, and doesn’t handle many
special features of Unicode, such as combining diacriticals.</li>
<li>The multiline support is imperfect and only supports manual
line-breaking – it can not break up a paragraph into lines of a
certain length.</li>
<li>It also does not handle inline formatting changes in order to
support something like Markdown, reStructuredText or HTML.  (Though
rich-text formatting is contemplated in this MEP, since we want to
make sure this design allows it, the specifics of a rich-text
formatting implementation is outside of the scope of this MEP.)</li>
</ul>
<p>Supporting these things is difficult, and is the “full-time job” of a
number of other projects:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.pango.org/">pango</a>/<a class="reference external" href="https://www.freedesktop.org/wiki/Software/HarfBuzz/">harfbuzz</a></li>
<li><a class="reference external" href="http://doc.qt.io/qt-4.8/qtextlayout.html">QtTextLayout</a></li>
<li><a class="reference external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd371554(v=vs.85).aspx">Microsoft DirectWrite</a></li>
<li><a class="reference external" href="https://developer.apple.com/library/content/documentation/StringsTextFonts/Conceptual/CoreText_Programming/Overview/Overview.html">Apple Core Text</a></li>
</ul>
</div></blockquote>
<p>Of the above options, it should be noted that <code class="xref py py-obj docutils literal"><span class="pre">harfbuzz</span></code> is designed
from the start as a cross platform option with minimal dependencies,
so therefore is a good candidate for a single option to support.</p>
<p>Additionally, for supporting rich text, we could consider using
<a class="reference external" href="https://webkit.org/">WebKit</a>, and possibly whether than
represents a good single cross-platform option.  Again, however, rich
text formatting is outside of the scope of this project.</p>
<p>Rather than trying to reinvent the wheel and add these features to
matplotlib’s “built-in” text renderer, we should provide a way to
leverage these projects to get more powerful text layout.  The
“built-in” renderer will still need to exist for reasons of ease of
installation, but its feature set will be more limited compared to the
others.  [TODO: This MEP should clearly decide what those limited
features are, and fix any bugs to bring the implementation into a
state of working correctly in all cases that we want it to work.  I
know &#64;leejjoon has some thoughts on this.]</p>
<p><strong>Font selection</strong></p>
<p>Going from an abstract description of a font to a file on disk is the
task of the font selection algorithm – it turns out to be much more
complicated than it seems at first.</p>
<p>The “built-in” and “usetex” renderers have very different ways of
handling font selection, given their different technologies.  TeX
requires the installation of TeX-specific font packages, for example,
and can not use TrueType fonts directly.  Unfortunately, despite the
different semantics for font selection, the same set of font
properties are used for each.  This is true of both the
<code class="xref py py-obj docutils literal"><span class="pre">FontProperties</span></code> class and the font-related <code class="xref py py-obj docutils literal"><span class="pre">rcParams</span></code> (which
basically share the same code underneath).  Instead, we should define
a core set of font selection parameters that will work across all text
engines, and have engine-specific configuration to allow the user to
do engine-specific things when required.  For example, it is possible
to directly select a font by name in the “built-in” using
<code class="xref py py-obj docutils literal"><span class="pre">font.family</span></code>, but the same is not possible with “usetex”.  It may be
possible to make it easier to use TrueType fonts by using XeTeX, but
users will still want to use the traditional metafonts through TeX
font packages.  So the issue still stands that different text engines
will need engine-specific configuration, and it should be more obvious
to the user which configuration will work across text engines and
which are engine-specific.</p>
<p>Note that even excluding “usetex”, there are different ways to find
fonts.  The default is to use the font list cache in <code class="xref py py-obj docutils literal"><span class="pre">font_manager.py</span></code>
which matches fonts using our own algorithm based on the <a class="reference external" href="http://www.w3.org/TR/CSS2/fonts.html#algorithm">CSS font
matching algorithm</a>.
It doesn’t always do the same thing as the native font selection
algorithms on Linux (<a class="reference external" href="https://www.freedesktop.org/wiki/Software/fontconfig/">fontconfig</a>), Mac and
Windows, and it doesn’t always find all of the fonts on the system
that the OS would normally pick up.  However, it is cross-platform,
and always finds the fonts that ship with matplotlib.  The Cairo and
MacOSX backends (and presumably a future HTML5-based backend)
currently bypass this mechanism and use the OS-native ones.  The same
is true when not embedding fonts in SVG, PS or PDF files and opening
them in a third-party viewer.  A downside there is that (at least with
Cairo, need to confirm with MacOSX) they don’t always find the fonts
we ship with matplotlib.  (It may be possible to add the fonts to
their search path, though, or we may need to find a way to install our
fonts to a location the OS expects to find them).</p>
<p>There are also special modes in the PS and PDF to only use the core
fonts that are always available to those formats.  There, the font
lookup mechanism must only match against those fonts.  It is unclear
whether the OS-native font lookup systems can handle this case.</p>
<p>There is also experimental support for using <a class="reference external" href="https://www.freedesktop.org/wiki/Software/fontconfig/">fontconfig</a> for font
selection in matplotlib, turned off by default.  fontconfig is the
native font selection algorithm on Linux, but is also cross platform
and works well on the other platforms (though obviously is an
additional dependency there).</p>
<p>Many of the text layout libraries proposed above (pango, QtTextLayout,
DirectWrite and CoreText etc.) insist on using the font selection
library from their own ecosystem.</p>
<p>All of the above seems to suggest that we should move away from our
self-written font selection algorithm and use the native APIs where
possible.  That’s what Cairo and MacOSX backends already want to use,
and it will be a requirement of any complex text layout library.  On
Linux, we already have the bones of a <code class="xref py py-obj docutils literal"><span class="pre">fontconfig</span></code> implementation
(which could also be accessed through pango).  On Windows and Mac we
may need to write custom wrappers.  The nice thing is that the API for
font lookup is relatively small, and essentially consist of “given a
dictionary of font properties, give me a matching font file”.</p>
<p><strong>Font subsetting</strong></p>
<p>Font subsetting is currently handled using ttconv.  ttconv was a
standalone commandline utility for converting TrueType fonts to
subsetted Type 3 fonts (among other features) written in 1995, which
matplotlib (well, I) forked in order to make it work as a library.  It
only handles Apple-style TrueType fonts, not ones with the Microsoft
(or other vendor) encodings.  It doesn’t handle OpenType fonts at all.
This means that even though the STIX fonts come as .otf files, we have
to convert them to .ttf files to ship them with matplotlib.  The Linux
packagers hate this – they’d rather just depend on the upstream STIX
fonts.  ttconv has also been shown to have a few bugs that have been
difficult to fix over time.</p>
<p>Instead, we should be able to use FreeType to get the font outlines
and write our own code (probably in Python) to output subsetted fonts
(Type 3 on PS and PDF and SVGFonts or paths on SVG).  Freetype, as a
popular and well-maintained project, handles a wide variety of fonts
in the wild.  This would remove a lot of custom C code, and remove
some code duplication between backends.</p>
<p>Note that subsetting fonts this way, while the easiest route, does
lose the hinting in the font, so we will need to continue, as we do
now, provide a way to embed the entire font in the file where
possible.</p>
<p>Alternative font subsetting options include using the subsetting
built-in to Cairo (not clear if it can be used without the rest of
Cairo), or using <code class="xref py py-obj docutils literal"><span class="pre">fontforge</span></code> (which is a heavy and not terribly
cross-platform dependency).</p>
<p><strong>Freetype wrappers</strong></p>
<p>Our FreeType wrapper could really use a reworking.  It defines its own
image buffer class (when a Numpy array would be easier).  While
FreeType can handle a huge diversity of font files, there are
limitations to our wrapper that make it much harder to support
non-Apple-vendor TrueType files, and certain features of OpenType
files.  (See #2088 for a terrible result of this, just to support the
fonts that ship with Windows 7 and 8).  I think a fresh rewrite of
this wrapper would go a long way.</p>
<p><strong>Text anchoring and alignment and rotation</strong></p>
<p>The handling of baselines was changed in 1.3.0 such that the backends
are now given the location of the baseline of the text, not the bottom
of the text.  This is probably the correct behavior, and the MEP
refactoring should also follow this convention.</p>
<p>In order to support alignment on multi-line text, it should be the
responsibility of the (proposed) text engine to handle text alignment.
For a given chunk of text, each engine calculates a bounding box for
that text and the offset of the anchor point within that box.
Therefore, if the va of a block was “top”, the anchor point would be
at the top of the box.</p>
<p>Rotating of text should always be around the anchor point.  I’m not
sure that lines up with current behavior in matplotlib, but it seems
like the sanest/least surprising choice.  [This could be revisited
once we have something working].  Rotation of text should not be
handled by the text engine – that should be handled by a layer
between the text engine and the rendering backend so it can be handled
in a uniform way.  [I don’t see any advantage to rotation being
handled by the text engines individually…]</p>
<p>There are other problems with text alignment and anchoring that should
be resolved as part of this work.  [TODO: enumerate these].</p>
<p><strong>Other minor problems to fix</strong></p>
<p>The mathtext code has backend-specific code – it should instead
provide its output as just another text engine.  However, it’s still
desirable to have mathtext layout inserted as part of a larger layout
performed by another text engine, so it should be possible to do this.
It’s an open question whether embedding the text layout of an
arbitrary text engine in another should be possible.</p>
<p>The text mode is currently set by a global rcParam (“text.usetex”) so
it’s either all on or all off.  We should continue to have a global
rcParam to choose the text engine (“text.layout_engine”), but it
should under the hood be an overridable property on the <code class="xref py py-obj docutils literal"><span class="pre">Text</span></code> object,
so the same figure can combine the results of multiple text layout
engines if necessary.</p>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id6">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>A concept of a “text engine” will be introduced.  Each text engine
will implement a number of abstract classes.  The <code class="xref py py-obj docutils literal"><span class="pre">TextFont</span></code> interface
will represent text for a given set of font properties.  It isn’t
necessarily limited to a single font file – if the layout engine
supports rich text, it may handle a number of font files in a family.
Given a <code class="xref py py-obj docutils literal"><span class="pre">TextFont</span></code> instance, the user can get a <code class="xref py py-obj docutils literal"><span class="pre">TextLayout</span></code> instance,
which represents the layout for a given string of text in a given
font.  From a <code class="xref py py-obj docutils literal"><span class="pre">TextLayout</span></code>, an iterator over <code class="xref py py-obj docutils literal"><span class="pre">TextSpans</span></code> is returned
so the engine can output raw editable text using as few spans as
possible.  If the engine would rather get individual characters, they
can be obtained from the <code class="xref py py-obj docutils literal"><span class="pre">TextSpan</span></code> instance:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TextFont</span><span class="p">(</span><span class="n">TextFontBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font_properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new object for rendering text using the given font properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the TextLayout for the given string in the given font and</span>
<span class="sd">        the horizontal (left, center, right) and verticalalignment (top,</span>
<span class="sd">        center, baseline, bottom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TextLayout</span><span class="p">(</span><span class="n">TextLayoutBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the bounding box of the layout, anchored at (0, 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_spans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over the spans of different in the layout.</span>
<span class="sd">        This is useful for backends that want to editable raw text as</span>
<span class="sd">        individual lines.  For rich text where the font may change,</span>
<span class="sd">        each span of different font type will have its own span.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a rasterized image of the text.  Useful for raster backends,</span>
<span class="sd">        like Agg.</span>

<span class="sd">        In all likelihood, this will be overridden in the backend, as it can</span>
<span class="sd">        be created from get_layout(), but certain backends may want to</span>
<span class="sd">        override it if their library provides it (as freetype does).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_rectangles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over the filled black rectangles in the layout.</span>
<span class="sd">        Used by TeX and mathtext for drawing, for example, fraction lines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a single Path object of the entire layed out text.</span>

<span class="sd">        [Not strictly necessary, but might be useful for textpath</span>
<span class="sd">        functionality]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TextSpan</span><span class="p">(</span><span class="n">TextSpanBase</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span>      <span class="c1"># Position of the span -- relative to the text layout as a whole</span>
              <span class="c1"># where (0, 0) is the anchor.  y is the baseline of the span.</span>
    <span class="n">fontfile</span>  <span class="c1"># The font file to use for the span</span>
    <span class="n">text</span>      <span class="c1"># The text content of the span</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>  <span class="c1"># See TextLayout.get_path</span>

    <span class="k">def</span> <span class="nf">get_chars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over the characters in the span.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TextChar</span><span class="p">(</span><span class="n">TextCharBase</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span>      <span class="c1"># Position of the character -- relative to the text layout as</span>
              <span class="c1"># a whole, where (0, 0) is the anchor.  y is in the baseline</span>
              <span class="c1"># of the character.</span>
    <span class="n">codepoint</span> <span class="c1"># The unicode code point of the character -- only for informational</span>
              <span class="c1"># purposes, since the mapping of codepoint to glyph_id may have been</span>
              <span class="c1"># handled in a complex way by the layout engine.  This is an int</span>
              <span class="c1"># to avoid problems on narrow Unicode builds.</span>
    <span class="n">glyph_id</span>  <span class="c1"># The index of the glyph within the font</span>
    <span class="n">fontfile</span>  <span class="c1"># The font file to use for the char</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the path for the character.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="k">pass</span>
</pre></div>
</div>
<p>Graphic backends that want to output subset of fonts would likely
build up a file-global dictionary of characters where the keys are
(fontname, glyph_id) and the values are the paths so that only one
copy of the path for each character will be stored in the file.</p>
<p>Special casing: The “usetex” functionality currently is able to get
Postscript directly from TeX to insert directly in a Postscript file,
but for other backends, parses a DVI file and generates something more
abstract.  For a case like this, <code class="xref py py-obj docutils literal"><span class="pre">TextLayout</span></code> would implement
<code class="xref py py-obj docutils literal"><span class="pre">get_spans</span></code> for most backends, but add <code class="xref py py-obj docutils literal"><span class="pre">get_ps</span></code> for the Postscript
backend, which would look for the presence of this method and use it
if available, or fall back to <code class="xref py py-obj docutils literal"><span class="pre">get_spans</span></code>.  This kind of special
casing may also be necessary, for example, when the graphics backend
and text engine belong to the same ecosystem, e.g. Cairo and Pango, or
MacOSX and CoreText.</p>
<p>There are three main pieces to the implementation:</p>
<ol class="arabic simple">
<li>Rewriting the freetype wrapper, and removing ttconv.</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>Once (1) is done, as a proof of concept, we can move to the
upstream STIX .otf fonts</li>
<li>Add support for web fonts loaded from a remote URL.  (Enabled by using freetype for font subsetting).</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Refactoring the existing “builtin” and “usetex” code into separate text engines and to follow the API outlined above.</li>
<li>Implementing support for advanced text layout libraries.</li>
</ol>
<p>(1) and (2) are fairly independent, though having (1) done first will
allow (2) to be simpler.  (3) is dependent on (1) and (2), but even if
it doesn’t get done (or is postponed), completing (1) and (2) will
make it easier to move forward with improving the “builtin” text
engine.</p>
</div>
<div class="section" id="backward-compatibility">
<h2><a class="toc-backref" href="#id7">Backward compatibility</a><a class="headerlink" href="#backward-compatibility" title="Permalink to this headline">¶</a></h2>
<p>The layout of text with respect to its anchor and rotation will change
in hopefully small, but improved, ways.  The layout of multiline text
will be much better, as it will respect horizontal alignment.  The
layout of bidirectional text or other advanced Unicode features will
now work inherently, which may break some things if users are
currently using their own workarounds.</p>
<p>Fonts will be selected differently.  Hacks that used to sort of work
between the “builtin” and “usetex” text rendering engines may no
longer work.  Fonts found by the OS that weren’t previously found by
matplotlib may be selected.</p>
</div>
<div class="section" id="alternatives">
<h2><a class="toc-backref" href="#id8">Alternatives</a><a class="headerlink" href="#alternatives" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="footer">
        &copy; Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the Matplotlib development team; 2012 - 2017 The Matplotlib development team.
      Last updated on Oct 13, 2017.
      Created using <a
href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55954603-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
<footer>
  <!--Flipcause Integration v3.0// Flipcause Integration Instructions:
Install the following code block once in the website Header (after <head> tag) -->

<style>

.fc-black_overlay{
display:none; position: fixed; z-index:1000001; top: 0%;left: 0%;width: 100%;height: 100%;
background-color: black; filter: alpha(opacity=50); cursor:pointer; opacity:0.5;
}

.fc-white_content {
opacity:1; display:none; margin-top: -320px; margin-left: -485px; width:970px; height:640px;
position:fixed; top:50%; left:50%; border: none;z-index:1000002;overflow: auto;
}

.fc-main-box{
opacity:1; display:none; margin:15px auto 0 auto; width:930px; position:relative; z-index:1000003;
}

.fc-widget_close{
opacity:1; content:url(http://i1338.photobucket.com/albums/o691/WeCause/X_zpse4a7e538.png);
position:absolute; z-index=1000004; right:-16px; top:-16px; display:block; cursor:pointer;
}

.floating_button{
display: block; margin-top: 0px; margin-left: 0px; width:auto ; height: auto;
position:fixed; z-index:999999; overflow: auto;
}

@keyframes backfadesin {
   from { opacity:0; }
   to {opacity:.5;}
}

@-moz-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@-webkit-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@-o-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}


@-ms-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; transform: translateY(20px);}
   100% {opacity: 1; transform: translateY(0);}
}

@-moz-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -moz-transform: translateY(20px);}
   100% {opacity: 1; -moz-transform: translateY(0);}
}

@-webkit-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -webkit-transform: translateY(20px);}
   100% {opacity: 1; -webkit-transform: translateY(0);}
}

@-o-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -o-transform: translateY(20px);}
   100% {opacity: 1; -o-transform: translateY(0);}
}

@-ms-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -ms-transform: translateY(20px);}
   100% {opacity: 1; -ms-transform: translateY(0);}
}

</style>

<script>

function open_window(cause_id) {
var  protocol=String(document.location.protocol);
var new_url;
if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
new_url="https://www.flipcause.com/widget/"+cause_id
window.open(new_url);
}

else {
document.getElementById("fc-fade").style.display = "block";
document.getElementById("fc-fade").style.webkitAnimation = "backfadesin 1s";
document.getElementById("fc-fade").style.animation = "backfadesin 1s";
document.getElementById("fc-fade").style.mozAnimation = "backfadesin 1s";
document.getElementById("fc-light").style.display = "block";
document.getElementById("fc-light").style.webkitAnimation = "fadesin 1.5s";
document.getElementById("fc-light").style.animation = "fadesin 1.5s";
document.getElementById("fc-light").style.mozAnimation = "fadesin 1.5s";
document.getElementById("fc-main").style.display = "block";
document.getElementById("fc-main").style.webkitAnimation = "fadesin 1.5s";
document.getElementById("fc-main").style.animation = "fadesin 1.5s";
document.getElementById("fc-main").style.mozAnimation = "fadesin 1.5s";
document.getElementById("fc-close").style.display = "block";
document.getElementById("fc-close").style.webkitAnimation = "fadesin 1.5s";
document.getElementById("fc-close").style.animation = "fadesin 1.5s";
document.getElementById("fc-close").style.mozAnimation = "fadesin 1.5s";
document.getElementById("fc-myFrame").style.display = "block";
document.getElementById("fc-myFrame").style.webkitAnimation = "fadesin 1.5s";
document.getElementById("fc-myFrame").style.animation = "fadesin 1.5s";
document.getElementById("fc-myFrame").style.mozAnimation = "fadesin 1.5s";
document.getElementById("fc-myFrame").src="https://www.flipcause.com/widget/"+cause_id;
}
}


function close_window() {
document.getElementById("fc-fade").style.display="none";
document.getElementById("fc-light").style.display="none";
document.getElementById("fc-main").style.display="none";
document.getElementById("fc-close").style.display="none";
document.getElementById("fc-myFrame").style.display="none";
}

</script>

<div id="fc-fade" class="fc-black_overlay" onclick="close_window()"></div>
<div id="fc-light" class="fc-white_content">
<div id="fc-main" class="fc-main-box">
<div id="fc-close" class="fc-widget_close" onclick="close_window()">
</div><iframe id="fc-myFrame" iframe height="580" width="925" style="border: 0;
border-radius:5px 5px 5px 5px; box-shadow:0 0 8px rgba(0, 0, 0, 0.5);" scrolling="no" src=""></iframe></div>
</div>

<!--END Flipcause Main Integration Code-->
</footer>
</html>