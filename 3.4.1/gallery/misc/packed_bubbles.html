
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Packed-bubble chart &#8212; Matplotlib 3.4.1 documentation</title>
    <link rel="stylesheet" href="../../_static/mpl.css?v3.4.1-3-gc6d08c6a8b-dirty" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Matplotlib 3.4.1 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="top" title="Matplotlib 3.4.1 documentation" href="#" />
    <link rel="canonical" href="https://matplotlib.org/stable/gallery/misc/packed_bubbles.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

    <script data-domain="matplotlib.org" defer="defer" src="https://views.scientific-python.org/js/script.js"></script>
  </head><body>
<div id="unreleased-message"> You are reading an old version of the documentation (v3.4.1).  For the latest version see <a href="https://matplotlib.org/stable/gallery/misc/packed_bubbles.html">https://matplotlib.org/stable/gallery/misc/packed_bubbles.html</a></div>


<!--
<div id="annc-banner">

</div>
-->

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; position: relative;">
    <a href="../../index.html">
        <div style="float: left; position: absolute; width: 496px; bottom: 0; padding-bottom: 24px"><span style="float: right; color: #789; background: white">Version 3.4.1</span></div>
        <img src="../../_static/logo2_compressed.svg" height="125px" border="0" alt="matplotlib"/></a>

    <!-- The "Fork me on github" ribbon -->
    <div id="forkongithub"><a href="https://github.com/matplotlib/matplotlib">Fork me on GitHub</a></div>
    </div>

    <nav class="main-nav">
        <ul>
            <li><a href="../../users/installing.html">Installation</a></li>
            <li><a href="../../contents.html">Documentation</a></li>
            <li><a href="../index.html">Examples</a></li>
            <li><a href="../../tutorials/index.html">Tutorials</a></li>
            <li><a href="../../devel/index.html">Contributing</a></li>
            <li class="nav-right">
                <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" aria-labelledby="searchlabel" placeholder="Search"/>
                </form>
            </li>
        </ul>
     </nav>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../contents.html">contents</a> &raquo;</li>
        <li class="nav-item nav-item-this"><a href="">Packed-bubble chart</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div id="sidebar-pagesource" role="note" aria-label="source link"
    style="margin-top: 1.5em; padding-top: 0.1em; border-top: 1px solid #86989b">
  <a href="../../_sources/gallery/misc/packed_bubbles.rst.txt"
     style="color: #c0c0c0" rel="nofollow">Show Page Source</a>
  </div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-gallery-misc-packed-bubbles-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="packed-bubble-chart">
<span id="sphx-glr-gallery-misc-packed-bubbles-py"></span><h1>Packed-bubble chart<a class="headerlink" href="#packed-bubble-chart" title="Permalink to this headline">Â¶</a></h1>
<p>Create a packed-bubble chart to represent scalar data.
The presented algorithm tries to move all bubbles as close to the center of
mass as possible while avoiding some collisions by moving around colliding
objects. In this example we plot the market share of different desktop
browsers.
(source: <a class="reference external" href="https://gs.statcounter.com/browser-market-share/desktop/worldwidev">https://gs.statcounter.com/browser-market-share/desktop/worldwidev</a>)</p>
<img alt="Browser market share" class="sphx-glr-single-img" src="../../_images/sphx_glr_packed_bubbles_001.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">browser_market_share</span></a> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;browsers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;firefox&#39;</span><span class="p">,</span> <span class="s1">&#39;chrome&#39;</span><span class="p">,</span> <span class="s1">&#39;safari&#39;</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;ie&#39;</span><span class="p">,</span> <span class="s1">&#39;opera&#39;</span><span class="p">],</span>
    <span class="s1">&#39;market_share&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">8.61</span><span class="p">,</span> <span class="mf">69.55</span><span class="p">,</span> <span class="mf">8.36</span><span class="p">,</span> <span class="mf">4.12</span><span class="p">,</span> <span class="mf">2.76</span><span class="p">,</span> <span class="mf">2.43</span><span class="p">],</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#5A69AF&#39;</span><span class="p">,</span> <span class="s1">&#39;#579E65&#39;</span><span class="p">,</span> <span class="s1">&#39;#F9C784&#39;</span><span class="p">,</span> <span class="s1">&#39;#FC944A&#39;</span><span class="p">,</span> <span class="s1">&#39;#F24C00&#39;</span><span class="p">,</span> <span class="s1">&#39;#00B825&#39;</span><span class="p">]</span>
<span class="p">}</span>


<span class="k">class</span> <span class="nc">BubbleChart</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">bubble_spacing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup for bubble collapse.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        area : array-like</span>
<span class="sd">            Area of the bubbles.</span>
<span class="sd">        bubble_spacing : float, default: 0</span>
<span class="sd">            Minimal spacing between bubbles after collapsing.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If &quot;area&quot; is sorted, the results might look weird.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">area</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.asarray.html#numpy.asarray" title="numpy.asarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">asarray</span></a><span class="p">(</span><span class="n">area</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="n">area</span> <span class="o">/</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bubble_spacing</span> <span class="o">=</span> <span class="n">bubble_spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ones.html#numpy.ones" title="numpy.ones" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">area</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxstep</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxstep</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># calculate initial grid layout for bubbles</span>
        <span class="n">length</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">(</span><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">)))</span>
        <span class="n">grid</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.arange.html#numpy.arange" title="numpy.arange" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxstep</span>
        <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.meshgrid.html#numpy.meshgrid" title="numpy.meshgrid" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span></a><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gy</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">center_of_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.average.html#numpy.average" title="numpy.average" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">average</span></a><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">center_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bubble</span><span class="p">,</span> <span class="n">bubbles</span><span class="p">):</span>
        <span class="k">return</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">hypot</span></a><span class="p">(</span><span class="n">bubble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">bubble</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">outline_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bubble</span><span class="p">,</span> <span class="n">bubbles</span><span class="p">):</span>
        <span class="n">center_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_distance</span><span class="p">(</span><span class="n">bubble</span><span class="p">,</span> <span class="n">bubbles</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">center_distance</span> <span class="o">-</span> <span class="n">bubble</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> \
            <span class="n">bubbles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_spacing</span>

    <span class="k">def</span> <span class="nf">check_collisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bubble</span><span class="p">,</span> <span class="n">bubbles</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline_distance</span><span class="p">(</span><span class="n">bubble</span><span class="p">,</span> <span class="n">bubbles</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance</span><span class="p">[</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">collides_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bubble</span><span class="p">,</span> <span class="n">bubbles</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline_distance</span><span class="p">(</span><span class="n">bubble</span><span class="p">,</span> <span class="n">bubbles</span><span class="p">)</span>
        <span class="n">idx_min</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.argmin.html#numpy.argmin" title="numpy.argmin" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">argmin</span></a><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx_min</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idx_min</span><span class="p">)</span> <span class="o">==</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class"><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></a> <span class="k">else</span> <span class="p">[</span><span class="n">idx_min</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">collapse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move bubbles to the center of mass.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_iterations : int, default: 50</span>
<span class="sd">            Number of moves to perform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iterations</span><span class="p">):</span>
            <span class="n">moves</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">)):</span>
                <span class="n">rest_bub</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.delete.html#numpy.delete" title="numpy.delete" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">delete</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="c1"># try to move directly towards the center of mass</span>
                <span class="c1"># direction vector from bubble to the center of mass</span>
                <span class="n">dir_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

                <span class="c1"># shorten direction vector to have length of 1</span>
                <span class="n">dir_vec</span> <span class="o">=</span> <span class="n">dir_vec</span> <span class="o">/</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="n">dir_vec</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dir_vec</span><span class="p">))</span>

                <span class="c1"># calculate new bubble position</span>
                <span class="n">new_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dir_vec</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_dist</span>
                <span class="n">new_bubble</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.append.html#numpy.append" title="numpy.append" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">append</span></a><span class="p">(</span><span class="n">new_point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>

                <span class="c1"># check whether new bubble collides with other bubbles</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_collisions</span><span class="p">(</span><span class="n">new_bubble</span><span class="p">,</span> <span class="n">rest_bub</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">new_bubble</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">()</span>
                    <span class="n">moves</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># try to move around a bubble that you collide with</span>
                    <span class="c1"># find colliding bubble</span>
                    <span class="k">for</span> <span class="n">colliding</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collides_with</span><span class="p">(</span><span class="n">new_bubble</span><span class="p">,</span> <span class="n">rest_bub</span><span class="p">):</span>
                        <span class="c1"># calculate direction vector</span>
                        <span class="n">dir_vec</span> <span class="o">=</span> <span class="n">rest_bub</span><span class="p">[</span><span class="n">colliding</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">dir_vec</span> <span class="o">=</span> <span class="n">dir_vec</span> <span class="o">/</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="n">dir_vec</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dir_vec</span><span class="p">))</span>
                        <span class="c1"># calculate orthogonal vector</span>
                        <span class="n">orth</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">dir_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">dir_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                        <span class="c1"># test which direction to go</span>
                        <span class="n">new_point1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">orth</span> <span class="o">*</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">step_dist</span><span class="p">)</span>
                        <span class="n">new_point2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">orth</span> <span class="o">*</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">step_dist</span><span class="p">)</span>
                        <span class="n">dist1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_distance</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">new_point1</span><span class="p">]))</span>
                        <span class="n">dist2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_distance</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">new_point2</span><span class="p">]))</span>
                        <span class="n">new_point</span> <span class="o">=</span> <span class="n">new_point1</span> <span class="k">if</span> <span class="n">dist1</span> <span class="o">&lt;</span> <span class="n">dist2</span> <span class="k">else</span> <span class="n">new_point2</span>
                        <span class="n">new_bubble</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.append.html#numpy.append" title="numpy.append" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">append</span></a><span class="p">(</span><span class="n">new_point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_collisions</span><span class="p">(</span><span class="n">new_bubble</span><span class="p">,</span> <span class="n">rest_bub</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">new_bubble</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">moves</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_dist</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the bubble plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib.axes.Axes</span>
<span class="sd">        labels : list</span>
<span class="sd">            Labels of the bubbles.</span>
<span class="sd">        colors : list</span>
<span class="sd">            Colors of the bubbles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">)):</span>
            <span class="n">circ</span> <span class="o">=</span> <a href="../../api/_as_gen/matplotlib.patches.Circle.html#matplotlib.patches.Circle" title="matplotlib.patches.Circle" class="sphx-glr-backref-module-matplotlib-patches sphx-glr-backref-type-py-class"><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span></a><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <a href="../../api/_as_gen/matplotlib.axes.Axes.add_patch.html#matplotlib.axes.Axes.add_patch" title="matplotlib.axes.Axes.add_patch" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span></a><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
            <a href="../../api/_as_gen/matplotlib.axes.Axes.text.html#matplotlib.axes.Axes.text" title="matplotlib.axes.Axes.text" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">text</span></a><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bubbles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>


<span class="n">bubble_chart</span> <span class="o">=</span> <span class="n">BubbleChart</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">browser_market_share</span></a><span class="p">[</span><span class="s1">&#39;market_share&#39;</span><span class="p">],</span>
                           <span class="n">bubble_spacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">bubble_chart</span><span class="o">.</span><span class="n">collapse</span><span class="p">()</span>

<a href="../../api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="../../api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">))</span>
<span class="n">bubble_chart</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">browser_market_share</span></a><span class="p">[</span><span class="s1">&#39;browsers&#39;</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">browser_market_share</span></a><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>
<a href="../../api/_as_gen/matplotlib.axes.Axes.axis.html#matplotlib.axes.Axes.axis" title="matplotlib.axes.Axes.axis" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">axis</span></a><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<a href="../../api/_as_gen/matplotlib.axes.Axes.relim.html#matplotlib.axes.Axes.relim" title="matplotlib.axes.Axes.relim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">relim</span></a><span class="p">()</span>
<a href="../../api/_as_gen/matplotlib.axes.Axes.autoscale_view.html#matplotlib.axes.Axes.autoscale_view" title="matplotlib.axes.Axes.autoscale_view" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span></a><span class="p">()</span>
<a href="../../api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title" title="matplotlib.axes.Axes.set_title" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span></a><span class="p">(</span><span class="s1">&#39;Browser market share&#39;</span><span class="p">)</span>

<a href="../../api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-gallery-misc-packed-bubbles-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<a class="reference download internal" download="" href="../../_downloads/81bc179821dc9808604c256bcb20b3b0/packed_bubbles.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">packed_bubbles.py</span></code></a></div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<a class="reference download internal" download="" href="../../_downloads/5603cc695cbb30bf42fce32e93e19cf1/packed_bubbles.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">packed_bubbles.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature">Keywords: matplotlib code example, codex, python plot, pyplot
<a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


          </div>
          
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer>
    <div class="footer">
    &copy; Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the Matplotlib development team; 2012 - 2021 The Matplotlib development team.
<br />
    Last updated on Mar 31, 2021.
Created using
<a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.
Doc version v3.4.1-3-gc6d08c6a8b-dirty.
    </div>
</footer>
  </body>
</html>